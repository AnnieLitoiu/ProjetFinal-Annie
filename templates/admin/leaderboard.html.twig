{% extends 'base.html.twig' %}
{% block title %}Classement utilisateurs
{% endblock %}

{% block body %}
	<div class="container py-4">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h1 class="mb-0">Classement</h1>
			<a class="btn btn-outline-secondary" href="{{ path('admin_users') }}">← Retour tableau de bord</a>
		</div>

		<form method="get" class="mb-4">
			<div class="input-group">
				<input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Rechercher (email, prénom, nom)">
				<button class="btn btn-primary" type="submit">Rechercher</button>
			</div>
		</form>

		<div class="row g-3">
			{% for row in rows %}
				{% set user = row.user %}
				<div class="col-12 col-sm-6 col-md-4 col-lg-3">
					<div class="card h-100">
						<div class="card-body">
							{% set rank = loop.index %}
							{# numeric rank only #}
							<div class="d-flex justify-content-between align-items-start mb-2">
								<h5 class="card-title mb-0">
									<span class="badge bg-primary me-2">{{ rank }}</span>
									{{ user.prenom ?? '' }}
									{{ user.nom ?? '' }}
								</h5>
								<span class="badge bg-success">{{ row.bestPct|number_format(2, ',', ' ') }}%</span>
							</div>
							<p class="card-text text-muted small mb-2">{{ user.email }}</p>
							<p class="card-text text-muted small mb-3">{{ row.attempts }}
								tentative{{ row.attempts > 1 ? 's' : '' }}</p>
							<a class="btn btn-sm btn-outline-primary" href="{{ path('admin_user_show', {id: user.id}) }}">
								Voir détails
							</a>
						</div>
					</div>
				</div>
			{% else %}
				<div class="col-12">
					<div class="alert alert-info">Aucun utilisateur trouvé.</div>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
