{% extends 'base.html.twig' %}

{% block title %}Log in{% endblock %}

{% block body %}
    <form method="post">
        {% if error %}
            <div class="alert alert-danger">{{ error.messageKey|trans(error.messageData, 'security') }}</div>
        {% endif %}

        {% if app.user %}
            <div class="mb-3">
                Vous êtes connecté en tant que : {{ app.user.userIdentifier }}
                <a class="btn btn-outline-turquoise btn-sm" href="{{ path('app_logout') }}">Se déconnecter</a>
            </div>
        {% endif %}

        <h1 class="h3 mb-3 font-weight-normal">Veuillez vous connecter</h1>

        <label for="username">Email</label>
        <input type="email" value="{{ last_username }}" name="_username" id="username"
               class="form-control" autocomplete="email"
               placeholder="Entrez votre email" required autofocus><br><br>

        <label for="password">Mot de passe</label>
        <div class="input-group">
            <input type="password" name="_password" id="password"
                   class="form-control" autocomplete="current-password"
                   placeholder="Entrez votre mot de passe" required>
            <button type="button" class="btn btn-outline-secondary" id="togglePassword" 
                    aria-label="Afficher le mot de passe" title="Afficher le mot de passe">
                <span id="icon-eye" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8"/>
                        <path d="M8 5.5a2.5 2.5 0 1 1 0 5 2.5 2.5 0 0 1 0-5m0-1a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7"/>
                    </svg>
                </span>
                <span id="icon-eye-slash" aria-hidden="true" style="display:none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.027 7.027 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c3.314 0 5.773 2.559 6.746 4.005a13.134 13.134 0 0 1-2.115 2.466l-.272-.733z"/>
                        <path d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.828 2.828l.823.823z"/>
                        <path d="M3.35 5.47a13.134 13.134 0 0 0-2.115 2.466C2.207 9.381 4.666 11.94 7.98 11.94c.716 0 1.402-.12 2.037-.343l.772.772A7.027 7.027 0 0 1 8 13.5C3 13.5 0 8 0 8s.94-1.72 2.641-3.238l.708.708z"/>
                        <path d="M13.646 14.354 1.646 2.354l.708-.708 12 12-.708.708z"/>
                    </svg>
                </span>
            </button>
        </div>
        <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}"><br>

        <button class="btn btn-outline-turquoise btn-sm" type="submit">
            Se connecter
        </button>

        <p class="mt-3 text-center">
            Pas encore de compte ?
            <a href="{{ path('app_register') }}" class="link-turquoise">
                Créer un compte
            </a>
        </p>
    </form>

    <script>
    (function() {
      const btn = document.getElementById('togglePassword');
      const eye = document.getElementById('icon-eye');
      const eyeSlash = document.getElementById('icon-eye-slash');
      if (!btn || !eye || !eyeSlash) return;
      const pwd = document.getElementById('password');
      if (!pwd) return;

      const sync = () => {
        const isText = pwd.getAttribute('type') === 'text';
        eye.style.display = isText ? 'none' : '';
        eyeSlash.style.display = isText ? '' : 'none';
        btn.setAttribute('aria-label', isText ? 'Masquer le mot de passe' : 'Afficher le mot de passe');
        btn.setAttribute('title', isText ? 'Masquer le mot de passe' : 'Afficher le mot de passe');
      };
      sync();

      btn.addEventListener('click', () => {
        const isText = pwd.getAttribute('type') === 'text';
        pwd.setAttribute('type', isText ? 'password' : 'text');
        sync();
      });
    })();
    </script>
{% endblock %}
